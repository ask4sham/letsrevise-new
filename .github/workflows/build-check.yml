name: Build Integrity Check

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  check:
    runs-on: windows-latest  # Uses Windows because your project is on Windows
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        
    - name: Install dependencies (Frontend)
      run: |
        cd frontend
        npm ci
        
    - name: Install dependencies (Backend)
      run: |
        cd backend
        npm ci
        
    - name: Run Build Integrity Check
      run: node check-build.js || true
      
    - name: Run Frontend Lint Check
      run: |
        cd frontend
        npm run lint || true
      env:
        CI: false
        
    - name: Run Security Audit
      run: |
        cd frontend && npm audit --audit-level=high || true
        cd ../backend && npm audit --audit-level=high || true
        
    - name: Check for old brand references
      shell: powershell
      run: |
        echo "Checking for old brand references..."
        $found = $false
        Get-ChildItem -Path "frontend\src", "backend", "static-site" -Recurse -File -ErrorAction SilentlyContinue | ForEach-Object {
          if (Select-String -Path $_.FullName -Pattern "Let's Revise|Lets Revise|let's revise" -Quiet) {
            Write-Host "❌ Found old brand reference in $($_.FullName)"
            $found = $true
          }
        }
        if ($found) { exit 1 } else { Write-Host "✅ No old brand references found" }